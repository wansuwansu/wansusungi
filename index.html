<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>완수 ♥ 성지 완성데이트</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Nanum Gothic', sans-serif;
      background-color: #fdf9f3;
      padding: 20px;
      max-width: 700px;
      margin: auto;
    }
    h1 {
      color: #ff6f61;
      text-align: center;
      margin-bottom: 30px;
    }
    .region-select, .form-group {
      margin-bottom: 15px;
    }
    .rating span {
      font-size: 24px;
      cursor: pointer;
      color: lightgray;
    }
    .rating .selected {
      color: gold;
    }
    .card {
      background-color: #fffefb;
      border: 1px solid #ffd4c2;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(255, 183, 148, 0.2);
    }
    img {
      max-width: 100%;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div id="app">
    <h1>완성 데이트 기록장</h1>

    <!-- 지역 선택 -->
    <div class="region-select">
      <label>메인 지역:
        <select v-model="selectedMainRegion" @change="updateSubRegions">
          <option disabled value="">-- 선택하세요 --</option>
          <option v-for="region in mainRegions" :key="region">{{ region }}</option>
        </select>
      </label>
      <label>서브 지역:
        <select v-model="selectedSubRegion">
          <option disabled value="">-- 선택하세요 --</option>
          <option v-for="region in subRegions" :key="region">{{ region }}</option>
        </select>
      </label>
    </div>

    <!-- 새 장소 추가 폼 -->
    <div class="form-group">
      <input v-model="newPlace.name" placeholder="장소 이름" />
      <input v-model="newPlace.date" type="date" />
      <textarea v-model="newPlace.review" placeholder="후기 작성"></textarea>
      <input v-model="newPlace.imageUrl" placeholder="이미지 주소" />

      <!-- 별점 -->
      <div class="rating">
        <span
          v-for="star in 5"
          :key="star"
          @click="newPlace.rating = star"
          :class="{ selected: star <= newPlace.rating }"
        >★</span>
      </div>
      <button @click="addPlace">기록 추가</button>
    </div>

    <!-- 장소 리스트 -->
    <div v-for="(place, index) in places" :key="index" class="card">
      <h3>{{ place.name }} ({{ place.date }})</h3>
      <p><strong>위치:</strong> {{ place.mainRegion }} > {{ place.subRegion }}</p>
      <p><strong>후기:</strong> {{ place.review }}</p>
      <p><strong>별점:</strong> {{ '★'.repeat(place.rating) }}</p>
      <img v-if="place.imageUrl" :src="place.imageUrl" alt="사진" />
    </div>
  </div>

  <!-- Firebase SDK (CDN 방식) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDpg4cuUisMyaOUXI8Mcg6bPBUvMbKfv00",
      authDomain: "wansu-e747d.firebaseapp.com",
      projectId: "wansu-e747d",
      storageBucket: "wansu-e747d.appspot.com",
      messagingSenderId: "634282664500",
      appId: "1:634282664500:web:947e65d59a06dd9698a061",
      measurementId: "G-JCDSG4XGN5"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <script>
    new Vue({
      el: '#app',
      data: {
        mainRegions: ['서울', '경기', '부산', '강원', '제주'],
        regionMap: {
          서울: ['강남', '홍대', '잠실', '종로'],
          경기: ['수원', '성남', '의정부'],
          부산: ['해운대', '광안리', '서면'],
          강원: ['속초', '강릉', '춘천'],
          제주: ['제주시', '서귀포시']
        },
        selectedMainRegion: '',
        selectedSubRegion: '',
        newPlace: { name: '', date: '', review: '', imageUrl: '', rating: 0 },
        places: []
      },
      computed: {
        subRegions() {
          return this.regionMap[this.selectedMainRegion] || [];
        }
      },
      methods: {
        updateSubRegions() {
          this.selectedSubRegion = '';
        },
        addPlace() {
          const { name, date, review, rating, imageUrl } = this.newPlace;
          if (!name || !date || !review || rating === 0) {
            return alert('모든 필드를 입력해 주세요! 별점도 꼭 선택해야 합니다.');
          }

          const newRecord = {
            ...this.newPlace,
            mainRegion: this.selectedMainRegion,
            subRegion: this.selectedSubRegion,
            createdAt: new Date().toISOString()
          };

          this.places.unshift(newRecord);
          this.newPlace = { name: '', date: '', review: '', imageUrl: '', rating: 0 };

          // Firebase 저장
          db.collection("travelRecords").add(newRecord)
            .then(() => console.log("✅ Firebase 저장 완료"))
            .catch((error) => console.error("❌ Firebase 저장 실패:", error));
        }
      }
    });
  </script>
</body>
</html>
